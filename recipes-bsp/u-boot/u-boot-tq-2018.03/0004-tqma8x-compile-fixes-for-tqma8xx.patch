From 956c7ca51787f5b4e2c23568c1f91129c3cb0ab2 Mon Sep 17 00:00:00 2001
From: Markus Niebel <Markus.Niebel@tq-group.com>
Date: Thu, 14 Feb 2019 09:30:04 +0100
Subject: [PATCH] tqma8x: compile fixes for tqma8xx

Signed-off-by: Markus Niebel <Markus.Niebel@tq-group.com>
---
 arch/arm/mach-imx/imx8/Kconfig     |  6 +++---
 board/tqc/tqma8xx/tqma8xx-mba8xx.c |  8 ++++----
 board/tqc/tqma8xx/tqma8xx.c        |  8 ++++----
 configs/tqma8xx-mba8xx_defconfig   | 10 ++++------
 include/configs/tqma8xx.h          | 12 ++++++------
 5 files changed, 21 insertions(+), 23 deletions(-)

diff --git a/arch/arm/mach-imx/imx8/Kconfig b/arch/arm/mach-imx/imx8/Kconfig
index 990a2290b7..60ee2764f0 100644
--- a/arch/arm/mach-imx/imx8/Kconfig
+++ b/arch/arm/mach-imx/imx8/Kconfig
@@ -86,9 +86,9 @@ config TARGET_TQMA8XX
 	select ARM64_SUPPORT_AARCH32
 	select SYS_MALLOC_F
 	select ARCH_FIXUP_FDT_MEMORY
-	select MMC
-	select GENERIC_MMC
-	select DM_MMC
+	imply MMC
+	imply GENERIC_MMC
+	imply DM_MMC
 	select PINCTRL
 	select PINCTRL_FULL
 	select PINCTRL_GENERIC
diff --git a/board/tqc/tqma8xx/tqma8xx-mba8xx.c b/board/tqc/tqma8xx/tqma8xx-mba8xx.c
index 0fc04e51bc..e6ff8be4fb 100644
--- a/board/tqc/tqma8xx/tqma8xx-mba8xx.c
+++ b/board/tqc/tqma8xx/tqma8xx-mba8xx.c
@@ -9,7 +9,7 @@
 #include <netdev.h>
 #include <fsl_ifc.h>
 #include <fdt_support.h>
-#include <libfdt.h>
+#include <linux/libfdt.h>
 #include <environment.h>
 #include <fsl_esdhc.h>
 #include <i2c.h>
@@ -18,7 +18,7 @@
 #include <asm/io.h>
 #include <asm/gpio.h>
 #include <asm/arch/clock.h>
-#include <asm/imx-common/sci/sci.h>
+#include <asm/mach-imx/sci/sci.h>
 #include <asm/arch/imx8-pins.h>
 #include <dm.h>
 #include <usb.h>
@@ -477,8 +477,8 @@ int board_mmc_get_env_dev(int devno)
 int tqc_bb_board_late_init(void)
 {
 #ifdef CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG
-	setenv("board_name", "MEK");
-	setenv("board_rev", "iMX8QXP");
+	env_set("board_name", "MEK");
+	env_set("board_rev", "iMX8QXP");
 #endif
 
 #ifdef CONFIG_ENV_IS_IN_MMC
diff --git a/board/tqc/tqma8xx/tqma8xx.c b/board/tqc/tqma8xx/tqma8xx.c
index 640ca5c5a6..5af69c1b7d 100644
--- a/board/tqc/tqma8xx/tqma8xx.c
+++ b/board/tqc/tqma8xx/tqma8xx.c
@@ -9,7 +9,7 @@
 #include <netdev.h>
 #include <fsl_ifc.h>
 #include <fdt_support.h>
-#include <libfdt.h>
+#include <linux/libfdt.h>
 #include <environment.h>
 #include <fsl_esdhc.h>
 #include <i2c.h>
@@ -18,7 +18,7 @@
 #include <asm/io.h>
 #include <asm/gpio.h>
 #include <asm/arch/clock.h>
-#include <asm/imx-common/sci/sci.h>
+#include <asm/mach-imx/sci/sci.h>
 #include <asm/arch/imx8-pins.h>
 #include <dm.h>
 #include <imx8_hsio.h>
@@ -235,8 +235,8 @@ int ft_board_setup(void *blob, bd_t *bd)
 int board_late_init(void)
 {
 #ifdef CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG
-	setenv("board_name", "MEK");
-	setenv("board_rev", "iMX8QXP");
+	env_set("board_name", "MEK");
+	env_set("board_rev", "iMX8QXP");
 #endif
 
 	tqc_bb_board_late_init();
diff --git a/configs/tqma8xx-mba8xx_defconfig b/configs/tqma8xx-mba8xx_defconfig
index 70b68a17be..b46e71bf35 100644
--- a/configs/tqma8xx-mba8xx_defconfig
+++ b/configs/tqma8xx-mba8xx_defconfig
@@ -1,17 +1,19 @@
 CONFIG_ARM=y
 CONFIG_ARCH_IMX8=y
+CONFIG_SYS_TEXT_BASE=0x80020000
 CONFIG_SYS_MALLOC_F_LEN=0x2000
 CONFIG_TARGET_TQMA8XX=y
 CONFIG_DEFAULT_DEVICE_TREE="fsl-imx8qxp-tqma8xx-mba8xx"
 CONFIG_BOOTDELAY=3
 CONFIG_CONSOLE_MUX=y
+CONFIG_HUSH_PARSER=y
 # CONFIG_CMD_IMPORTENV is not set
+CONFIG_CMD_GPIO=y
+CONFIG_CMD_I2C=y
 CONFIG_CMD_MMC=y
 CONFIG_CMD_SF=y
-CONFIG_CMD_I2C=y
 CONFIG_CMD_USB=y
 CONFIG_CMD_USB_MASS_STORAGE=y
-CONFIG_CMD_GPIO=y
 CONFIG_CMD_DHCP=y
 CONFIG_CMD_MII=y
 CONFIG_CMD_PING=y
@@ -24,7 +26,6 @@ CONFIG_DM_I2C=y
 CONFIG_SYS_I2C_IMX_LPI2C=y
 CONFIG_I2C_MUX=y
 CONFIG_I2C_MUX_PCA954x=y
-# CONFIG_DM_MMC_OPS is not set
 CONFIG_DM_SPI_FLASH=y
 CONFIG_SPI_FLASH=y
 CONFIG_SPI_FLASH_4BYTES_ADDR=y
@@ -47,7 +48,4 @@ CONFIG_USB_STORAGE=y
 CONFIG_USB_GADGET=y
 CONFIG_CI_UDC=y
 CONFIG_USB_GADGET_DOWNLOAD=y
-CONFIG_G_DNL_MANUFACTURER="FSL"
-CONFIG_G_DNL_VENDOR_NUM=0x0525
-CONFIG_G_DNL_PRODUCT_NUM=0xa4a5
 # CONFIG_EFI_LOADER is not set
diff --git a/include/configs/tqma8xx.h b/include/configs/tqma8xx.h
index 5b66582e7f..d42f7eb3b4 100644
--- a/include/configs/tqma8xx.h
+++ b/include/configs/tqma8xx.h
@@ -231,16 +231,16 @@
 #define CONFIG_BAUDRATE			115200
 
 /* Monitor Command Prompt */
-#define CONFIG_SYS_LONGHELP
-#define CONFIG_HUSH_PARSER
+/* #define CONFIG_SYS_LONGHELP */
+/* #define CONFIG_HUSH_PARSER */
 #define CONFIG_SYS_PROMPT_HUSH_PS2     "> "
-#define CONFIG_AUTO_COMPLETE
+/* #define CONFIG_AUTO_COMPLETE */
 #define CONFIG_SYS_CBSIZE              1024
 #define CONFIG_SYS_MAXARGS             64
 #define CONFIG_SYS_BARGSIZE CONFIG_SYS_CBSIZE
 #define CONFIG_SYS_PBSIZE		(CONFIG_SYS_CBSIZE + \
 					sizeof(CONFIG_SYS_PROMPT) + 16)
-#define CONFIG_CMDLINE_EDITING
+/* #define CONFIG_CMDLINE_EDITING */ 
 
 /* Generic Timer Definitions */
 #define COUNTER_FREQUENCY		8000000	/* 8MHz */
@@ -272,7 +272,7 @@
 
 /* USB 3.0 controller configs */
 #ifdef CONFIG_USB_XHCI_IMX8
-#define CONFIG_SYS_USB_XHCI_MAX_ROOT_PORTS	2
+/* #define CONFIG_SYS_USB_XHCI_MAX_ROOT_PORTS	2 */
 #endif
 
 /* USB OTG controller configs */
@@ -285,7 +285,7 @@
 
 #ifdef CONFIG_USB_GADGET
 #define CONFIG_USBD_HS
-#define CONFIG_USB_FUNCTION_MASS_STORAGE
+/* #define CONFIG_USB_FUNCTION_MASS_STORAGE */
 #endif
 
 #define CONFIG_OF_SYSTEM_SETUP
