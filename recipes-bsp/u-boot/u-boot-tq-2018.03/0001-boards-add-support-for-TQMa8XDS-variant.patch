From 021b6c16b8e39c16047ed1b713d373a80c367b64 Mon Sep 17 00:00:00 2001
From: Markus Niebel <Markus.Niebel@tq-group.com>
Date: Wed, 17 Apr 2019 18:23:21 +0200
Subject: [PATCH] boards: add support for TQMa8XDS variant

    - i.MX8DX CPU
    - device tree
    - Kconfig

Signed-off-by: Markus Niebel <Markus.Niebel@tq-group.com>
---
 arch/arm/dts/Makefile                         |  1 +
 .../dts/fsl-imx8dx-tqma8dxs-mb-smarc-2.dts    | 42 +++++++++++++++++++
 board/tqc/tqma8qxs/Kconfig                    | 11 +++--
 3 files changed, 51 insertions(+), 3 deletions(-)
 create mode 100644 arch/arm/dts/fsl-imx8dx-tqma8dxs-mb-smarc-2.dts

diff --git a/arch/arm/dts/Makefile b/arch/arm/dts/Makefile
index 03fbac83fd..e4bff0806e 100644
--- a/arch/arm/dts/Makefile
+++ b/arch/arm/dts/Makefile
@@ -473,6 +473,7 @@ dtb-$(CONFIG_ARCH_IMX8M) += fsl-imx8mq-evk.dtb \
 
 dtb-$(CONFIG_ARCH_IMX8) += fsl-imx8dx-ddr3-arm2.dtb \
 		fsl-imx8dx-tqma8xd-mba8xx.dtb \
+		fsl-imx8dx-tqma8dxs-mb-smarc-2.dtb \
 		fsl-imx8qm-ddr4-arm2.dtb \
 		fsl-imx8qm-lpddr4-arm2.dtb \
 		fsl-imx8qm-mek.dtb \
diff --git a/arch/arm/dts/fsl-imx8dx-tqma8dxs-mb-smarc-2.dts b/arch/arm/dts/fsl-imx8dx-tqma8dxs-mb-smarc-2.dts
new file mode 100644
index 0000000000..49621b8b14
--- /dev/null
+++ b/arch/arm/dts/fsl-imx8dx-tqma8dxs-mb-smarc-2.dts
@@ -0,0 +1,42 @@
+/*
+ * Copyright 2019 TQ Systems GmbH
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ */
+
+#include "fsl-imx8qxp-tqma8qxps-mb-smarc-2.dts"
+
+/ {
+	model = "TQ Systems i.MX8DX TQMa8XDS on MB-SMARC-2";
+	compatible = "tq,tqma8dxs-mb-smarc-2", "tq,tqma8dxs", "fsl,imx8qxp";
+};
+
+&fec2 {
+	status = "disabled";
+};
+
+&lpuart0 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_lpuart0>;
+	status = "okay";
+};
+
+&usbotg1 {
+	status = "disabled";
+};
+
+&usb2 {
+	status = "disabled";
+};
+
+&usdhc2 {
+	status = "okay";
+};
diff --git a/board/tqc/tqma8qxs/Kconfig b/board/tqc/tqma8qxs/Kconfig
index 605f45c3ed..1d3035aa86 100644
--- a/board/tqc/tqma8qxs/Kconfig
+++ b/board/tqc/tqma8qxs/Kconfig
@@ -11,12 +11,17 @@ config SYS_CONFIG_NAME
 
 choice
 	prompt "TQMa8QXS CPU variant"
-	default TQMA8QXS_MX8QXP
+	default TQMA8QXS_CPU_MX8QXP
 	help
 	  Select cpu variant for TQMa8QXS
 
-config TQMA8QXS_MX8QXP
-	bool "TQMa8QXS with i.MX8QXP"
+config TQMA8QXS_CPU_MX8QXP
+	bool "TQMa8XQPS with i.MX8QXP"
+	help
+	  Select the CPU variant
+
+config TQMA8QXS_CPU_MX8DX
+	bool "TQMa8XDS with i.MX8DX"
 	help
 	  Select the CPU variant
 
