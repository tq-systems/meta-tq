From c0ec0077d915b530801ba3e274617430d47bea64 Mon Sep 17 00:00:00 2001
From: Markus Niebel <Markus.Niebel@tq-group.com>
Date: Mon, 13 May 2019 15:33:41 +0200
Subject: [PATCH] board: tqma8xx-mbpa8xx: handle board gpio init

Signed-off-by: Markus Niebel <Markus.Niebel@tq-group.com>
---
 board/tqc/tqma8xx/tqma8xx-mbpa8xx.c | 57 +++++++++++++++++++++++++++++
 1 file changed, 57 insertions(+)

diff --git a/board/tqc/tqma8xx/tqma8xx-mbpa8xx.c b/board/tqc/tqma8xx/tqma8xx-mbpa8xx.c
index f975dc3553..f4400a2646 100644
--- a/board/tqc/tqma8xx/tqma8xx-mbpa8xx.c
+++ b/board/tqc/tqma8xx/tqma8xx-mbpa8xx.c
@@ -87,8 +87,65 @@ int tqc_bb_checkboard(void)
 	return 0;
 }
 
+#ifdef CONFIG_MXC_GPIO
+struct gpio_init_data {
+	const char* name;
+	const char* label;
+	unsigned long flags;
+};
+
+static const struct gpio_init_data mbpa8xx_gid[] = {
+	{
+		.name = "GPIO1_0",
+		.label = "REV_0",
+		.flags = GPIOD_IS_IN,
+	}, {
+		.name = "GPIO1_1",
+		.label = "REV_1",
+		.flags = GPIOD_IS_IN,
+	}, {
+		.name = "GPIO1_2",
+		.label = "REV_2",
+		.flags = GPIOD_IS_IN,
+	}, {
+		.name = "GPIO1_7",
+		.label = "GNSS_#RST",
+		.flags = GPIOD_IS_OUT,
+	}, {
+		.name = "GPIO1_13",
+		.label = "WWAN_#RST",
+		.flags = GPIOD_IS_OUT,
+	},
+};
+
+static void board_gpio_init(void)
+{
+	int i;
+	int ret;
+	struct gpio_desc desc;
+
+
+	for (i = 0; i < ARRAY_SIZE(mbpa8xx_gid); ++i) {
+		ret = dm_gpio_lookup_name(mbpa8xx_gid[i].name, &desc);
+		if (ret) {
+			printf("error: gpio lookup %s", mbpa8xx_gid[i].name);
+		} else {
+			ret = dm_gpio_request(&desc, mbpa8xx_gid[i].label);
+			if (ret)
+				printf("error: gpio REQ %s", mbpa8xx_gid[i].label);
+			else
+				dm_gpio_set_dir_flags(&desc, mbpa8xx_gid[i].flags);
+		}
+	}
+}
+#else
+static inline void board_gpio_init(void) {}
+#endif
+
 int tqc_bb_board_init(void)
 {
+	board_gpio_init();
+
 	return 0;
 }
 
