From 0b65dc13d6aa0b72747bc7399714206f3149ba73 Mon Sep 17 00:00:00 2001
From: Markus Niebel <Markus.Niebel@tq-group.com>
Date: Wed, 10 Apr 2019 20:24:58 +0200
Subject: [PATCH] boards: add support for TQMa8DX variant

- i.MX8DX CPU
- device tree
- Kconfig

Signed-off-by: Markus Niebel <Markus.Niebel@tq-group.com>
---
 arch/arm/dts/Makefile                      |  1 +
 arch/arm/dts/fsl-imx8dx-tqma8dx-mba8xx.dts | 50 ++++++++++++++++++++++
 board/tqc/tqma8qx/Kconfig                  |  7 ++-
 3 files changed, 57 insertions(+), 1 deletion(-)
 create mode 100644 arch/arm/dts/fsl-imx8dx-tqma8dx-mba8xx.dts

diff --git a/arch/arm/dts/Makefile b/arch/arm/dts/Makefile
index 167891ead9..2ea20e2c37 100644
--- a/arch/arm/dts/Makefile
+++ b/arch/arm/dts/Makefile
@@ -472,6 +472,7 @@ dtb-$(CONFIG_ARCH_IMX8M) += fsl-imx8mq-evk.dtb \
 		fsl-imx8mq-tqma8mq-mba8mx.dtb
 
 dtb-$(CONFIG_ARCH_IMX8) += fsl-imx8dx-ddr3-arm2.dtb \
+		fsl-imx8dx-tqma8dx-mba8xx.dtb \
 		fsl-imx8qm-ddr4-arm2.dtb \
 		fsl-imx8qm-lpddr4-arm2.dtb \
 		fsl-imx8qm-mek.dtb \
diff --git a/arch/arm/dts/fsl-imx8dx-tqma8dx-mba8xx.dts b/arch/arm/dts/fsl-imx8dx-tqma8dx-mba8xx.dts
new file mode 100644
index 0000000000..9db2b42911
--- /dev/null
+++ b/arch/arm/dts/fsl-imx8dx-tqma8dx-mba8xx.dts
@@ -0,0 +1,50 @@
+/*
+ * Copyright 2019 TQ Systems GmbH
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ */
+
+#include "fsl-imx8qxp-tqma8qxp-mba8xx.dts"
+
+/ {
+	model = "TQ Systems i.MX8DX TQMa8DX on MBa8Xx";
+	compatible = "tq,tqma8dx-mba8xx", "tq,tqma8dx", "fsl,imx8qxp";
+};
+
+&fec2 {
+	status = "disabled";
+};
+
+&lpuart1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_lpuart1>;
+	status = "okay";
+};
+
+&usbotg1 {
+	status = "disabled";
+};
+
+&usb2 {
+	status = "disabled";
+};
+
+&usdhc2 {
+	pinctrl-names = "default", "state_100mhz", "state_200mhz";
+	pinctrl-0 = <&pinctrl_usdhc2>, <&pinctrl_usdhc2_gpio>;
+	pinctrl-1 = <&pinctrl_usdhc2_100mhz>, <&pinctrl_usdhc2_gpio>;
+	pinctrl-2 = <&pinctrl_usdhc2_200mhz>, <&pinctrl_usdhc2_gpio>;
+	bus-width = <4>;
+	cd-gpios = <&gpio4 22 GPIO_ACTIVE_LOW>;
+	wp-gpios = <&gpio4 21 GPIO_ACTIVE_HIGH>;
+	vmmc-supply = <&reg_usdhc2_vmmc>;
+	status = "okay";
+};
diff --git a/board/tqc/tqma8qx/Kconfig b/board/tqc/tqma8qx/Kconfig
index ab0f307bbc..2d6be16ca2 100644
--- a/board/tqc/tqma8qx/Kconfig
+++ b/board/tqc/tqma8qx/Kconfig
@@ -18,7 +18,12 @@ choice
 config TQMA8QX_MX8QXP
 	bool "TQMa8QX with i.MX8QXP"
 	help
-	  Select the CPU variant
+	  Select the CPU i.MX8QXP / i.MX8DXP
+
+config TQMA8QX_MX8DX
+	bool "TQMa8QX with i.MX8QXP"
+	help
+	  Select the CPU i.MX8QXP / i.MX8DXP
 
 endchoice
 
