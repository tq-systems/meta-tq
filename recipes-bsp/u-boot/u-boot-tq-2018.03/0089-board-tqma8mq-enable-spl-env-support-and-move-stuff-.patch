From 906d24217b1cc9d545c6d121b1679c6f08f7c6da Mon Sep 17 00:00:00 2001
From: Markus Niebel <Markus.Niebel@tq-group.com>
Date: Mon, 18 Feb 2019 17:41:23 +0100
Subject: [PATCH] board: tqma8mq: enable spl env support and move stuff to
 Kconfig

Signed-off-by: Markus Niebel <Markus.Niebel@tq-group.com>
---
 arch/arm/mach-imx/imx8m/Kconfig               | 10 ++++++++++
 configs/tqma8mq_2gmicron_mba8mx_mmc_defconfig |  2 --
 configs/tqma8mq_mba8mx_mmc_defconfig          |  2 --
 include/configs/tqma8mx.h                     |  9 ++++++---
 4 files changed, 16 insertions(+), 7 deletions(-)

diff --git a/arch/arm/mach-imx/imx8m/Kconfig b/arch/arm/mach-imx/imx8m/Kconfig
index 23399455c6..d92b406658 100644
--- a/arch/arm/mach-imx/imx8m/Kconfig
+++ b/arch/arm/mach-imx/imx8m/Kconfig
@@ -73,6 +73,16 @@ config TARGET_TQMA8MX
 	select MISC
 	select SUPPORT_SPL
 	select SPL
+	select SPL_BOARD_INIT
+	select SPL_ENV_SUPPORT
+	select SPL_SERIAL_SUPPORT
+	select SPL_GPIO_SUPPORT
+	select SPL_MMC_SUPPORT
+	select SPL_DRIVERS_MISC_SUPPORT
+	select SPL_POWER_SUPPORT
+	select SPL_I2C_SUPPORT
+	select SPL_LIBGENERIC_SUPPORT
+	select SPL_LIBCOMMON_SUPPORT
 	select TQC_EEPROM
 
 endchoice
diff --git a/configs/tqma8mq_2gmicron_mba8mx_mmc_defconfig b/configs/tqma8mq_2gmicron_mba8mx_mmc_defconfig
index 1f1eb61c55..ca08a1ca2d 100644
--- a/configs/tqma8mq_2gmicron_mba8mx_mmc_defconfig
+++ b/configs/tqma8mq_2gmicron_mba8mx_mmc_defconfig
@@ -9,8 +9,6 @@ CONFIG_FIT=y
 CONFIG_SPL_LOAD_FIT=y
 CONFIG_SYS_EXTRA_OPTIONS="IMX_CONFIG=arch/arm/mach-imx/spl_sd.cfg"
 CONFIG_ARCH_MISC_INIT=y
-CONFIG_SPL=y
-CONFIG_SPL_BOARD_INIT=y
 CONFIG_HUSH_PARSER=y
 CONFIG_CMD_MEMINFO=y
 CONFIG_CMD_MEMTEST=y
diff --git a/configs/tqma8mq_mba8mx_mmc_defconfig b/configs/tqma8mq_mba8mx_mmc_defconfig
index 2da67b7d4a..ab08eac96d 100644
--- a/configs/tqma8mq_mba8mx_mmc_defconfig
+++ b/configs/tqma8mq_mba8mx_mmc_defconfig
@@ -8,8 +8,6 @@ CONFIG_FIT=y
 CONFIG_SPL_LOAD_FIT=y
 CONFIG_SYS_EXTRA_OPTIONS="IMX_CONFIG=arch/arm/mach-imx/spl_sd.cfg"
 CONFIG_ARCH_MISC_INIT=y
-CONFIG_SPL=y
-CONFIG_SPL_BOARD_INIT=y
 CONFIG_HUSH_PARSER=y
 CONFIG_CMD_MEMINFO=y
 CONFIG_CMD_MEMTEST=y
diff --git a/include/configs/tqma8mx.h b/include/configs/tqma8mx.h
index b87f5817f4..88b683b598 100644
--- a/include/configs/tqma8mx.h
+++ b/include/configs/tqma8mx.h
@@ -29,17 +29,19 @@
 /* #define CONFIG_SPL_ENV_SUPPORT */
 /*#define CONFIG_ENABLE_DDR_TRAINING_DEBUG*/
 #define CONFIG_SPL_WATCHDOG_SUPPORT
-#define CONFIG_SPL_DRIVERS_MISC_SUPPORT
-#define CONFIG_SPL_POWER_SUPPORT
-#define CONFIG_SPL_I2C_SUPPORT
 /* #define CONFIG_SPL_BOARD_INIT */
 #define CONFIG_SPL_LDSCRIPT		"arch/arm/cpu/armv8/u-boot-spl.lds"
 #define CONFIG_SPL_STACK		0x187FF0
+/*
+#define CONFIG_SPL_DRIVERS_MISC_SUPPORT
+#define CONFIG_SPL_POWER_SUPPORT
+#define CONFIG_SPL_I2C_SUPPORT
 #define CONFIG_SPL_LIBCOMMON_SUPPORT
 #define CONFIG_SPL_LIBGENERIC_SUPPORT
 #define CONFIG_SPL_SERIAL_SUPPORT
 #define CONFIG_SPL_GPIO_SUPPORT
 #define CONFIG_SPL_MMC_SUPPORT
+*/
 #define CONFIG_SPL_BSS_START_ADDR      0x00180000
 #define CONFIG_SPL_BSS_MAX_SIZE        0x2000	/* 8 KB */
 #define CONFIG_SYS_SPL_MALLOC_START	0x42200000
@@ -53,6 +55,7 @@
 #define CONFIG_SPL_ABORT_ON_RAW_IMAGE /* For RAW image gives a error info not panic */
 
 #undef CONFIG_DM_MMC
+#undef CONFIG_BLK
 #undef CONFIG_DM_PMIC
 #undef CONFIG_DM_PMIC_PFUZE100
 
