From c6b120d2915abbccfd46d223ea7cba4d79637c97 Mon Sep 17 00:00:00 2001
From: Markus Niebel <Markus.Niebel@tq-group.com>
Date: Fri, 9 Aug 2019 12:10:50 +0200
Subject: [PATCH] tqma8mx: drop support for second 2 GiB memory variant

Signed-off-by: Markus Niebel <Markus.Niebel@tq-group.com>
---
 board/tqc/tqma8mx/Kconfig                     | 15 ++----
 board/tqc/tqma8mx/lpddr4_timing_1g.c          |  4 +-
 board/tqc/tqma8mx/lpddr4_timing_2gs.c         |  4 +-
 board/tqc/tqma8mx/spl.c                       | 13 ++---
 configs/tqma8mq_2gmicron_mba8mx_mmc_defconfig |  2 +-
 configs/tqma8mq_mba8mx_mmc_defconfig          | 54 -------------------
 include/configs/tqma8mx.h                     |  2 +-
 7 files changed, 16 insertions(+), 78 deletions(-)
 delete mode 100644 configs/tqma8mq_mba8mx_mmc_defconfig

diff --git a/board/tqc/tqma8mx/Kconfig b/board/tqc/tqma8mx/Kconfig
index 9fad8821a2..281d62d700 100644
--- a/board/tqc/tqma8mx/Kconfig
+++ b/board/tqc/tqma8mx/Kconfig
@@ -11,19 +11,14 @@ config SYS_CONFIG_NAME
 
 choice
 	prompt "TQMa8MX Memory variant"
-	default TQMA8MX_2G_SAMSUNG
+	default TQMA8MX_2G
 	help
-	  Select cpu variant for TQMa8MX
+	  Select memory variant for TQMa8MX
 
-config TQMA8MX_2G_SAMSUNG
-	bool "TQMa8MX with 2GB LPDDR4 Samsung"
+config TQMA8MX_2G
+	bool "TQMa8MX with 2GB LPDDR4"
 	help
-	  Select module with 2GB LPDDR4 Samsung"
-
-config TQMA8MX_2G_MICRON
-	bool "TQMa8MX with 2GB LPDDR4 Micron"
-	help
-	  Select module with 2GB LPDDR4 Micron"
+	  Select module with 2GB LPDDR4"
 
 config TQMA8MX_1G
 	bool "TQMa8MX with 1GB LPDDR4"
diff --git a/board/tqc/tqma8mx/lpddr4_timing_1g.c b/board/tqc/tqma8mx/lpddr4_timing_1g.c
index 19ee9cc426..26e38f9360 100644
--- a/board/tqc/tqma8mx/lpddr4_timing_1g.c
+++ b/board/tqc/tqma8mx/lpddr4_timing_1g.c
@@ -5,7 +5,7 @@
  *
  * Generated code from MX8M_DDR_tool
  * Align with uboot-imx_v2018.03_4.14.78_1.0.0_ga
- * REV.0003 1GB_K4F8E3S4HB-MFCJ03V-SEC813
+ * REV.0003 1GB_K4F8E3S4HB-MFCJ03V-SEC813 (HW REV.010x)
  * from MX8M_LPDDR4_RPA_v23.xlsx / MX8 DDR Stress Test V2.10
  */
 
@@ -1720,7 +1720,7 @@ static struct dram_fsp_msg ddr_dram_fsp_msg[] = {
 };
 
 /* ddr timing config params */
-struct dram_timing_info dram_timing_1g = {
+struct dram_timing_info tqma8mx_1gb_dram_timing_r010x = {
 	.ddrc_cfg = ddr_ddrc_cfg,
 	.ddrc_cfg_num = ARRAY_SIZE(ddr_ddrc_cfg),
 	.ddrphy_cfg = ddr_ddrphy_cfg,
diff --git a/board/tqc/tqma8mx/lpddr4_timing_2gs.c b/board/tqc/tqma8mx/lpddr4_timing_2gs.c
index d4e076ef17..2f419efcc7 100644
--- a/board/tqc/tqma8mx/lpddr4_timing_2gs.c
+++ b/board/tqc/tqma8mx/lpddr4_timing_2gs.c
@@ -5,7 +5,7 @@
  *
  * Generated code from MX8M_DDR_tool
  * Align with uboot-imx_v2018.03_4.14.78_1.0.0_ga
- * REV.0003 2GB_K4F6E3S4HM-GFCL03V-SEC804
+ * REV.0003 2GB_K4F6E3S4HM-GFCL03V-SEC804 (HW REV.010x)
  * from MX8M_LPDDR4_RPA_v23.xlsx / MX8 DDR Stress Test V2.10
  */
 
@@ -1720,7 +1720,7 @@ static struct dram_fsp_msg ddr_dram_fsp_msg[] = {
 };
 
 /* ddr timing config params */
-struct dram_timing_info dram_timing_2gs = {
+struct dram_timing_info tqma8mx_2gb_dram_timing_r010x = {
 	.ddrc_cfg = ddr_ddrc_cfg,
 	.ddrc_cfg_num = ARRAY_SIZE(ddr_ddrc_cfg),
 	.ddrphy_cfg = ddr_ddrphy_cfg,
diff --git a/board/tqc/tqma8mx/spl.c b/board/tqc/tqma8mx/spl.c
index d6437c0211..1665dc14dc 100644
--- a/board/tqc/tqma8mx/spl.c
+++ b/board/tqc/tqma8mx/spl.c
@@ -29,9 +29,8 @@
 
 DECLARE_GLOBAL_DATA_PTR;
 
-extern struct dram_timing_info dram_timing_2gs;
-extern struct dram_timing_info dram_timing_2gm;
-extern struct dram_timing_info dram_timing_1g;
+extern struct dram_timing_info tqma8mx_2gb_dram_timing_r010x;
+extern struct dram_timing_info tqma8mx_1gb_dram_timing_r010x;
 
 static void spl_dram_init(void)
 {
@@ -43,12 +42,10 @@ static void spl_dram_init(void)
 		printf("SPL: no timing for this chip rev\n");
 		hang();
 	} else {
-#if defined(CONFIG_TQMA8MX_2G_SAMSUNG)
-		ddr_init(&dram_timing_2gs);
-#elif defined(CONFIG_TQMA8MX_2G_MICRON)
-		ddr_init(&dram_timing_2gm);
+#if defined(CONFIG_TQMA8MX_2G)
+		ddr_init(&tqma8mx_2gb_dram_timing_r010x);
 #elif defined(CONFIG_TQMA8MX_1G)
-		ddr_init(&dram_timing_1g);
+		ddr_init(&tqma8mx_1gb_dram_timing_r010x);
 #else
 #error
 #endif
diff --git a/configs/tqma8mq_2gmicron_mba8mx_mmc_defconfig b/configs/tqma8mq_2gmicron_mba8mx_mmc_defconfig
index 2ecb63c3b8..7295a59a02 100644
--- a/configs/tqma8mq_2gmicron_mba8mx_mmc_defconfig
+++ b/configs/tqma8mq_2gmicron_mba8mx_mmc_defconfig
@@ -3,7 +3,7 @@ CONFIG_ARCH_IMX8M=y
 CONFIG_SYS_TEXT_BASE=0x40200000
 CONFIG_SYS_MALLOC_F_LEN=0x2000
 CONFIG_TARGET_TQMA8MX=y
-CONFIG_TQMA8MX_2G_MICRON=y
+CONFIG_TQMA8MX_2G=y
 CONFIG_DEFAULT_DEVICE_TREE="fsl-imx8mq-tqma8mq-mba8mx"
 CONFIG_DISTRO_DEFAULTS=y
 CONFIG_FIT=y
diff --git a/configs/tqma8mq_mba8mx_mmc_defconfig b/configs/tqma8mq_mba8mx_mmc_defconfig
deleted file mode 100644
index 3355e634ca..0000000000
--- a/configs/tqma8mq_mba8mx_mmc_defconfig
+++ /dev/null
@@ -1,54 +0,0 @@
-CONFIG_ARM=y
-CONFIG_ARCH_IMX8M=y
-CONFIG_SYS_TEXT_BASE=0x40200000
-CONFIG_SYS_MALLOC_F_LEN=0x2000
-CONFIG_TARGET_TQMA8MX=y
-CONFIG_DEFAULT_DEVICE_TREE="fsl-imx8mq-tqma8mq-mba8mx"
-CONFIG_DISTRO_DEFAULTS=y
-CONFIG_FIT=y
-CONFIG_SPL_LOAD_FIT=y
-CONFIG_SYS_EXTRA_OPTIONS="IMX_CONFIG=arch/arm/mach-imx/spl_sd.cfg"
-CONFIG_BOOTDELAY=3
-CONFIG_BOOTCOMMAND="run mmcboot"
-CONFIG_VERSION_VARIABLE=y
-CONFIG_ARCH_MISC_INIT=y
-CONFIG_CMD_LICENSE=y
-CONFIG_CMD_GREPENV=y
-CONFIG_CMD_MEMINFO=y
-CONFIG_CMD_MEMTEST=y
-CONFIG_CMD_GPIO=y
-CONFIG_CMD_I2C=y
-CONFIG_CMD_CACHE=y
-CONFIG_CMD_TIME=y
-CONFIG_CMD_PMIC=y
-CONFIG_CMD_REGULATOR=y
-CONFIG_CMD_FS_GENERIC=y
-CONFIG_CMD_UBI=y
-CONFIG_EFI_PARTITION=y
-# CONFIG_SPL_EFI_PARTITION is not set
-CONFIG_OF_CONTROL=y
-CONFIG_ENV_IS_IN_MMC=y
-CONFIG_IMX8M_LPDDR4=y
-CONFIG_SAVED_DRAM_TIMING_BASE=0x40000000
-CONFIG_DM_GPIO=y
-CONFIG_DM_I2C=y
-CONFIG_SYS_I2C_MXC=y
-CONFIG_DM_MMC=y
-CONFIG_MMC_IO_VOLTAGE=y
-CONFIG_MMC_UHS_SUPPORT=y
-CONFIG_MMC_HS400_SUPPORT=y
-CONFIG_PHY_GIGE=y
-CONFIG_DM_PMIC=y
-CONFIG_DM_PMIC_PFUZE100=y
-CONFIG_DM_REGULATOR=y
-CONFIG_DM_REGULATOR_PFUZE100=y
-CONFIG_DM_REGULATOR_FIXED=y
-CONFIG_DM_REGULATOR_GPIO=y
-CONFIG_DM_THERMAL=y
-CONFIG_NXP_TMU=y
-CONFIG_VIDEO=y
-CONFIG_VIDEO_IMX8_HDMI=y
-CONFIG_FS_EXT4=y
-CONFIG_EXT4_WRITE=y
-CONFIG_FS_FAT=y
-CONFIG_FAT_WRITE=y
diff --git a/include/configs/tqma8mx.h b/include/configs/tqma8mx.h
index 3ce5b0b701..a422e93ea9 100644
--- a/include/configs/tqma8mx.h
+++ b/include/configs/tqma8mx.h
@@ -277,7 +277,7 @@
 #define CONFIG_SYS_SDRAM_BASE		0x40000000
 #define PHYS_SDRAM			0x40000000
 
-#if defined(CONFIG_TQMA8MX_2G_MICRON) || defined(CONFIG_TQMA8MX_2G_SAMSUNG)
+#if defined(CONFIG_TQMA8MX_2G)
 #define PHYS_SDRAM_SIZE			0x80000000 /* 2GB LPDDR4 */
 #elif defined (CONFIG_TQMA8MX_1G)
 #define PHYS_SDRAM_SIZE			0x40000000 /* 1GB LPDDR4 */
