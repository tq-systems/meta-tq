From f4b18df98f1de21ecd3a9b15e1d481ece866051a Mon Sep 17 00:00:00 2001
From: Markus Niebel <Markus.Niebel@tq-group.com>
Date: Thu, 24 Jan 2019 10:27:22 +0100
Subject: [PATCH 29/37] tqma8mql: add 2 GiB variant

Signed-off-by: Markus Niebel <Markus.Niebel@tq-group.com>
---
 board/tqc/tqma8mx/Kconfig             |  7 ++++++-
 board/tqc/tqma8mx/Makefile            |  2 +-
 board/tqc/tqma8mx/spl.c               |  6 ++++++
 configs/tqma8mql_mba8mx_mmc_defconfig | 25 +++++++++++++++++++++++++
 include/configs/tqma8mx.h             | 14 +++++++++++---
 5 files changed, 49 insertions(+), 5 deletions(-)
 create mode 100644 configs/tqma8mql_mba8mx_mmc_defconfig

diff --git a/board/tqc/tqma8mx/Kconfig b/board/tqc/tqma8mx/Kconfig
index 10327c065a..ecb063eb21 100644
--- a/board/tqc/tqma8mx/Kconfig
+++ b/board/tqc/tqma8mx/Kconfig
@@ -18,7 +18,12 @@ choice
 config TQMA8MX_MX8MQ
 	bool "TQMa8MX with i.MX8MQ"
 	help
-	  Select the CPU variant
+	  Select i.MX8MQ with 1 GiB LPDDR4
+
+config TQMA8MX_MX8MQL
+	bool "TQMa8MX with i.MX8MQL"
+	help
+	  Select i.MX8MQL with 2 GiB LPDDR4
 
 endchoice
 
diff --git a/board/tqc/tqma8mx/Makefile b/board/tqc/tqma8mx/Makefile
index eafd3c5f96..9bd7bcebe7 100644
--- a/board/tqc/tqma8mx/Makefile
+++ b/board/tqc/tqma8mx/Makefile
@@ -11,5 +11,5 @@ obj-$(CONFIG_MBA8MX) += tqma8mx-mba8mx.o
 ifdef CONFIG_SPL_BUILD
 obj-y += spl.o
 obj-$(CONFIG_MBA8MX) += spl-mba8mx.o
-obj-y += ddr/ddr_init.o ddr/ddrphy_train.o ddr/helper.o
+obj-$(CONFIG_TQMA8MX_MX8MQL) += ddr/ddr_init.o ddr/ddrphy_train.o ddr/helper.o
 endif
diff --git a/board/tqc/tqma8mx/spl.c b/board/tqc/tqma8mx/spl.c
index 5ee96b34e6..710f4b8b8e 100644
--- a/board/tqc/tqma8mx/spl.c
+++ b/board/tqc/tqma8mx/spl.c
@@ -31,7 +31,13 @@ void spl_dram_init(void)
 {
 	puts("spl_dram_init\n");
 	/* ddr init */
+#if defined(CONFIG_TQMA8MX_MX8MQ)
+	panic("no DDR timing for TQMa8MQ / 1 GiB LPDDR4\n")
+#elif defined(CONFIG_TQMA8MX_MX8MQL)
 	ddr_init();
+#else
+#error
+#endif
 }
 
 #define I2C_PAD_CTRL	(PAD_CTL_DSE6 | PAD_CTL_HYS | PAD_CTL_PUE)
diff --git a/configs/tqma8mql_mba8mx_mmc_defconfig b/configs/tqma8mql_mba8mx_mmc_defconfig
new file mode 100644
index 0000000000..30fd4a481c
--- /dev/null
+++ b/configs/tqma8mql_mba8mx_mmc_defconfig
@@ -0,0 +1,25 @@
+CONFIG_ARM=y
+CONFIG_ARCH_IMX8M=y
+CONFIG_SYS_MALLOC_F_LEN=0x2000
+CONFIG_TARGET_TQMA8MX=y
+CONFIG_TQMA8MX_MX8MQL=y
+CONFIG_DEFAULT_DEVICE_TREE="fsl-imx8mq-tqma8mq-mba8mx"
+CONFIG_FIT=y
+CONFIG_SPL_LOAD_FIT=y
+CONFIG_SYS_EXTRA_OPTIONS="IMX_CONFIG=arch/arm/imx-common/spl_sd.cfg"
+CONFIG_ARCH_MISC_INIT=y
+CONFIG_HUSH_PARSER=y
+CONFIG_CMD_MEMTEST=y
+CONFIG_CMD_MEMINFO=y
+CONFIG_CMD_I2C=y
+# CONFIG_CMD_FPGA is not set
+CONFIG_CMD_GPIO=y
+CONFIG_CMD_CACHE=y
+CONFIG_CMD_TIME=y
+CONFIG_CMD_FS_GENERIC=y
+CONFIG_CMD_UBI=y
+CONFIG_EFI_PARTITION=y
+# CONFIG_SPL_EFI_PARTITION is not set
+CONFIG_OF_CONTROL=y
+CONFIG_SYS_I2C_MXC=y
+CONFIG_NXP_TMU=y
diff --git a/include/configs/tqma8mx.h b/include/configs/tqma8mx.h
index ba23f85028..b69c12fde3 100644
--- a/include/configs/tqma8mx.h
+++ b/include/configs/tqma8mx.h
@@ -237,9 +237,17 @@
 /* Size of malloc() pool */
 #define CONFIG_SYS_MALLOC_LEN		((CONFIG_ENV_SIZE + (2*1024) + (16*1024)) * 1024)
 
-#define CONFIG_SYS_SDRAM_BASE           0x40000000
-#define PHYS_SDRAM                      0x40000000
-#define PHYS_SDRAM_SIZE			0x40000000 /* 1GB DDR */
+#define CONFIG_SYS_SDRAM_BASE		0x40000000
+#define PHYS_SDRAM			0x40000000
+
+#if defined(CONFIG_TQMA8MX_MX8MQ)
+#define PHYS_SDRAM_SIZE			0x40000000 /* 1GB LPDDR4 */
+#elif defined(CONFIG_TQMA8MX_MX8MQL)
+#define PHYS_SDRAM_SIZE			0x80000000 /* 2GB LPDDR4 */
+#else
+#error
+#endif
+
 #define CONFIG_NR_DRAM_BANKS		1
 
 #define CONFIG_SYS_MEMTEST_START	(CONFIG_SYS_SDRAM_BASE + SZ_128M)
-- 
2.17.1

