From dc09993b5bb3087987ce92072eb8c5ea264918bb Mon Sep 17 00:00:00 2001
From: Markus Niebel <Markus.Niebel@tq-group.com>
Date: Thu, 24 Jan 2019 10:27:59 +0100
Subject: [PATCH 40/42] HACK: tqma8mq: add video support

Signed-off-by: Markus Niebel <Markus.Niebel@tq-group.com>
---
 board/tqc/tqma8mx/Kconfig          |  1 +
 board/tqc/tqma8mx/tqma8mx-mba8mx.c | 47 ++++++++++++++++++++++++++++++
 include/configs/tqma8mx-mba8mx.h   | 14 +++++++++
 3 files changed, 62 insertions(+)

diff --git a/board/tqc/tqma8mx/Kconfig b/board/tqc/tqma8mx/Kconfig
index 1241718296..5ca8edb1af 100644
--- a/board/tqc/tqma8mx/Kconfig
+++ b/board/tqc/tqma8mx/Kconfig
@@ -53,6 +53,7 @@ config MBA8MX
 	select CMD_EXT4
 	select CMD_EXT4_WRITE
 	select CONFIG_DOS_PARTITION
+	select CFB_CONSOLE
 	help
 	  Select the MBa8MX starterkit. This features a GigE Phy, USB, SD-Card
 	  etc.
diff --git a/board/tqc/tqma8mx/tqma8mx-mba8mx.c b/board/tqc/tqma8mx/tqma8mx-mba8mx.c
index 804a8cc258..34d168a648 100644
--- a/board/tqc/tqma8mx/tqma8mx-mba8mx.c
+++ b/board/tqc/tqma8mx/tqma8mx-mba8mx.c
@@ -205,3 +205,50 @@ int tqc_bb_board_late_init(void)
 	return 0;
 }
 
+#if defined(CONFIG_VIDEO_IMXDCSS)
+#include <asm/imx-common/video.h>
+#include <asm/arch/video_common.h>
+
+struct display_info_t const displays[] = {{
+	.bus	= 0, /* Unused */
+	.addr	= 0, /* Unused */
+	.pixfmt	= GDF_32BIT_X888RGB,
+	.detect	= NULL,
+	.enable	= NULL,
+#ifndef CONFIG_VIDEO_IMXDCSS_1080P
+	.mode	= {
+		.name           = "HDMI", /* 720P60 */
+		.refresh        = 60,
+		.xres           = 1280,
+		.yres           = 720,
+		.pixclock       = 13468, /* 74250  kHz */
+		.left_margin    = 110,
+		.right_margin   = 220,
+		.upper_margin   = 5,
+		.lower_margin   = 20,
+		.hsync_len      = 40,
+		.vsync_len      = 5,
+		.sync           = FB_SYNC_HOR_HIGH_ACT | FB_SYNC_VERT_HIGH_ACT,
+		.vmode          = FB_VMODE_NONINTERLACED
+	}
+#else
+	.mode	= {
+		.name           = "HDMI", /* 1080P60 */
+		.refresh        = 60,
+		.xres           = 1920,
+		.yres           = 1080,
+		.pixclock       = 6734, /* 148500 kHz */
+		.left_margin    = 148,
+		.right_margin   = 88,
+		.upper_margin   = 36,
+		.lower_margin   = 4,
+		.hsync_len      = 44,
+		.vsync_len      = 5,
+		.sync           = FB_SYNC_HOR_HIGH_ACT | FB_SYNC_VERT_HIGH_ACT,
+		.vmode          = FB_VMODE_NONINTERLACED
+	}
+#endif
+} };
+size_t display_count = ARRAY_SIZE(displays);
+
+#endif /* CONFIG_VIDEO_IMXDCSS */
diff --git a/include/configs/tqma8mx-mba8mx.h b/include/configs/tqma8mx-mba8mx.h
index 9226fff01f..ec5991cba2 100644
--- a/include/configs/tqma8mx-mba8mx.h
+++ b/include/configs/tqma8mx-mba8mx.h
@@ -26,4 +26,18 @@
 #define CONFIG_DM_PCA953X
 #endif
 
+/* Framebuffer */
+#define CONFIG_VIDEO
+#ifdef CONFIG_VIDEO
+#define CONFIG_VIDEO_IMX8_HDMI
+#define CONFIG_VIDEO_IMXDCSS
+#define CONFIG_VIDEO_BMP_RLE8
+#define CONFIG_SPLASH_SCREEN
+#define CONFIG_SPLASH_SCREEN_ALIGN
+#define CONFIG_BMP_16BPP
+#define CONFIG_VIDEO_LOGO
+#define CONFIG_VIDEO_BMP_LOGO
+#define CONFIG_IMX_VIDEO_SKIP
+#endif
+
 #endif /* __TQMA8MX_MBA8MX_H */
-- 
2.17.1

