From 22581c561689465416bbf3b0aa83cf3627685423 Mon Sep 17 00:00:00 2001
From: Markus Niebel <Markus.Niebel@tq-group.com>
Date: Wed, 16 Jan 2019 20:15:52 +0100
Subject: [PATCH 16/25] board: tqma8mx: prepare RGMII / FEC interface

use correct clock for FEC / ENET

Signed-off-by: Markus Niebel <Markus.Niebel@tq-group.com>
---
 board/tqc/tqma8mx/tqma8mx-mba8mx.c | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/board/tqc/tqma8mx/tqma8mx-mba8mx.c b/board/tqc/tqma8mx/tqma8mx-mba8mx.c
index 5b305a37bd..e71423477c 100644
--- a/board/tqc/tqma8mx/tqma8mx-mba8mx.c
+++ b/board/tqc/tqma8mx/tqma8mx-mba8mx.c
@@ -64,6 +64,16 @@ int tqc_bb_ft_board_setup(void *blob, bd_t *bd)
 }
 #endif
 
+#ifdef CONFIG_FEC_MXC
+static int setup_fec(void)
+{
+	/* Use 125M anatop REF_CLK1 for ENET1, not from external */
+	clrsetbits_le32(IOMUXC_GPR1,
+			BIT(13) | BIT(17), 0);
+	return set_clk_enet(ENET_125MHz);
+}
+#endif
+
 #ifdef CONFIG_USB_DWC3
 
 #define USB_PHY_CTRL0			0xF0040
@@ -159,6 +169,10 @@ int board_usb_cleanup(int index, enum usb_init_type init)
 
 int tqc_bb_board_init(void)
 {
+#ifdef CONFIG_FEC_MXC
+	setup_fec();
+#endif
+
 #ifdef CONFIG_USB_TCPC
 	setup_typec();
 #endif
-- 
2.17.1

