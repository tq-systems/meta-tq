From 2a6fdead355c6e94db9436158536ef8565333d89 Mon Sep 17 00:00:00 2001
From: Markus Niebel <Markus.Niebel@tq-group.com>
Date: Tue, 27 Aug 2019 17:19:09 +0200
Subject: [PATCH]  tqc: initial support for TQMa8QM - part 2

Signed-off-by: Markus Niebel <Markus.Niebel@tq-group.com>
---
 arch/arm/dts/Makefile                     |   1 +
 arch/arm/dts/fsl-imx8qm-tqma8qm-mba8x.dts | 196 ++++++++++++++++++++++
 arch/arm/dts/fsl-imx8qm-tqma8qm.dtsi      | 113 +++++++++++++
 board/tqc/tqma8x/tqma8x-mba8x.c           |  18 +-
 board/tqc/tqma8x/tqma8x.c                 |   5 +-
 configs/tqma8qm_mba8x_mmc_defconfig       | 106 ++++++------
 include/configs/tqma8x.h                  |   2 +-
 7 files changed, 372 insertions(+), 69 deletions(-)
 create mode 100644 arch/arm/dts/fsl-imx8qm-tqma8qm-mba8x.dts
 create mode 100644 arch/arm/dts/fsl-imx8qm-tqma8qm.dtsi

diff --git a/arch/arm/dts/Makefile b/arch/arm/dts/Makefile
index efe915bbd4..c10f00cb02 100644
--- a/arch/arm/dts/Makefile
+++ b/arch/arm/dts/Makefile
@@ -478,6 +478,7 @@ dtb-$(CONFIG_ARCH_IMX8) += fsl-imx8dx-ddr3-arm2.dtb \
 		fsl-imx8qm-lpddr4-arm2.dtb \
 		fsl-imx8qm-mek.dtb \
 		fsl-imx8qm-mek-xen.dtb \
+		fsl-imx8qm-tqma8qm-mba8x.dtb \
 		fsl-imx8qxp-lpddr4-arm2.dtb \
 		fsl-imx8qxp-mek.dtb \
 		fsl-imx8qxp-tqma8xqp-mba8xx.dtb \
diff --git a/arch/arm/dts/fsl-imx8qm-tqma8qm-mba8x.dts b/arch/arm/dts/fsl-imx8qm-tqma8qm-mba8x.dts
new file mode 100644
index 0000000000..2aebceb73c
--- /dev/null
+++ b/arch/arm/dts/fsl-imx8qm-tqma8qm-mba8x.dts
@@ -0,0 +1,196 @@
+/*
+ * Copyright 2019 TQ Systems GmbH
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ */
+
+/dts-v1/;
+
+#include "fsl-imx8qm.dtsi"
+#include "fsl-imx8qm-tqma8qm.dtsi"
+
+/ {
+	model = "TQ Systems GmbH TQMa8QM on MBa8x";
+	compatible = "tq,tqma8qm-mba8x, tq,tqma8qm", "fsl,imx8qm";
+
+	chosen {
+		bootargs = "console=ttyLP0,115200 earlycon=lpuart32,0x5a060000,115200";
+		stdout-path = &lpuart0;
+	};
+
+	reg_mba8x_v3v3: mba8x_v3v3 {
+		compatible = "regulator-fixed";
+		regulator-name = "MBa8x-V3V3";
+		regulator-min-microvolt = <3300000>;
+		regulator-max-microvolt = <3300000>;
+		regulator-always-on;
+	};
+};
+
+&fec1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_fec1>;
+	phy-mode = "rgmii";
+	phy-handle = <&ethphy0>;
+	fsl,magic-packet;
+	fsl,rgmii_txc_dly;
+	fsl,rgmii_rxc_dly;
+	status = "disabled";
+
+	mdio {
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		ethphy0: ethernet-phy@0 {
+			compatible = "ethernet-phy-ieee802.3-c22";
+			reg = <0>;
+		};
+
+		ethphy1: ethernet-phy@1 {
+			compatible = "ethernet-phy-ieee802.3-c22";
+			reg = <1>;
+		};
+	};
+};
+
+&fec2 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_fec2>;
+	phy-mode = "rgmii";
+	phy-handle = <&ethphy1>;
+	fsl,magic-packet;
+	status = "disabled";
+};
+
+&iomuxc {
+	mba8x {
+		pinctrl_fec1: fec1grp {
+			fsl,pins = <
+				SC_P_COMP_CTL_GPIO_1V8_3V3_ENET_ENETB_PAD	0x000014a0
+				SC_P_ENET0_MDC_CONN_ENET0_MDC			0x06000020
+				SC_P_ENET0_MDIO_CONN_ENET0_MDIO			0x06000020
+				SC_P_ENET0_RGMII_TX_CTL_CONN_ENET0_RGMII_TX_CTL	0x00000060
+				SC_P_ENET0_RGMII_TXC_CONN_ENET0_RGMII_TXC	0x00000060
+				SC_P_ENET0_RGMII_TXD0_CONN_ENET0_RGMII_TXD0	0x00000060
+				SC_P_ENET0_RGMII_TXD1_CONN_ENET0_RGMII_TXD1	0x00000060
+				SC_P_ENET0_RGMII_TXD2_CONN_ENET0_RGMII_TXD2	0x00000060
+				SC_P_ENET0_RGMII_TXD3_CONN_ENET0_RGMII_TXD3	0x00000060
+				SC_P_ENET0_RGMII_RXC_CONN_ENET0_RGMII_RXC	0x00000060
+				SC_P_ENET0_RGMII_RX_CTL_CONN_ENET0_RGMII_RX_CTL	0x00000060
+				SC_P_ENET0_RGMII_RXD0_CONN_ENET0_RGMII_RXD0	0x00000060
+				SC_P_ENET0_RGMII_RXD1_CONN_ENET0_RGMII_RXD1	0x00000060
+				SC_P_ENET0_RGMII_RXD2_CONN_ENET0_RGMII_RXD2	0x00000060
+				SC_P_ENET0_RGMII_RXD3_CONN_ENET0_RGMII_RXD3	0x00000060
+			>;
+		};
+
+		pinctrl_fec2: fec2grp {
+			fsl,pins = <
+				SC_P_COMP_CTL_GPIO_1V8_3V3_ENET_ENETA_PAD	0x000014a0
+				SC_P_ENET1_RGMII_TX_CTL_CONN_ENET1_RGMII_TX_CTL	0x00000060
+				SC_P_ENET1_RGMII_TXC_CONN_ENET1_RGMII_TXC	0x00000060
+				SC_P_ENET1_RGMII_TXD0_CONN_ENET1_RGMII_TXD0	0x00000060
+				SC_P_ENET1_RGMII_TXD1_CONN_ENET1_RGMII_TXD1	0x00000060
+				SC_P_ENET1_RGMII_TXD2_CONN_ENET1_RGMII_TXD2	0x00000060
+				SC_P_ENET1_RGMII_TXD3_CONN_ENET1_RGMII_TXD3	0x00000060
+				SC_P_ENET1_RGMII_RXC_CONN_ENET1_RGMII_RXC	0x00000060
+				SC_P_ENET1_RGMII_RX_CTL_CONN_ENET1_RGMII_RX_CTL	0x00000060
+				SC_P_ENET1_RGMII_RXD0_CONN_ENET1_RGMII_RXD0	0x00000060
+				SC_P_ENET1_RGMII_RXD1_CONN_ENET1_RGMII_RXD1	0x00000060
+				SC_P_ENET1_RGMII_RXD2_CONN_ENET1_RGMII_RXD2	0x00000060
+				SC_P_ENET1_RGMII_RXD3_CONN_ENET1_RGMII_RXD3	0x00000060
+			>;
+		};
+
+		pinctrl_lpuart0: lpuart0grp {
+			fsl,pins = <
+				SC_P_UART0_RX_DMA_UART0_RX		0x06000020
+				SC_P_UART0_TX_DMA_UART0_TX		0x06000020
+				SC_P_UART0_CTS_B_DMA_UART0_CTS_B	0x00000021
+				SC_P_UART0_RTS_B_DMA_UART0_RTS_B	0x00000021
+			>;
+		};
+
+		pinctrl_usdhc2_gpio: usdhc2grpgpio {
+			fsl,pins = <
+				SC_P_USDHC1_DATA6_LSIO_GPIO5_IO21	0x00000021
+				SC_P_USDHC1_DATA7_LSIO_GPIO5_IO22	0x00000021
+				SC_P_USDHC1_RESET_B_LSIO_GPIO4_IO07	0x00000021
+			>;
+		};
+
+		pinctrl_usdhc2: usdhc2grp {
+			fsl,pins = <
+				SC_P_USDHC1_CLK_CONN_USDHC1_CLK		0x06000041
+				SC_P_USDHC1_CMD_CONN_USDHC1_CMD		0x00000021
+				SC_P_USDHC1_DATA0_CONN_USDHC1_DATA0	0x00000021
+				SC_P_USDHC1_DATA1_CONN_USDHC1_DATA1	0x00000021
+				SC_P_USDHC1_DATA2_CONN_USDHC1_DATA2	0x00000021
+				SC_P_USDHC1_DATA3_CONN_USDHC1_DATA3	0x00000021
+				SC_P_USDHC1_VSELECT_CONN_USDHC1_VSELECT	0x00000021
+			>;
+		};
+
+		pinctrl_usdhc2_100mhz: usdhc2grp100mhz {
+			fsl,pins = <
+				SC_P_USDHC1_CLK_CONN_USDHC1_CLK		0x06000040
+				SC_P_USDHC1_CMD_CONN_USDHC1_CMD		0x00000020
+				SC_P_USDHC1_DATA0_CONN_USDHC1_DATA0	0x00000020
+				SC_P_USDHC1_DATA1_CONN_USDHC1_DATA1	0x00000020
+				SC_P_USDHC1_DATA2_CONN_USDHC1_DATA2	0x00000020
+				SC_P_USDHC1_DATA3_CONN_USDHC1_DATA3	0x00000020
+				SC_P_USDHC1_VSELECT_CONN_USDHC1_VSELECT	0x00000020
+			>;
+		};
+
+		pinctrl_usdhc2_200mhz: usdhc2grp200mhz {
+			fsl,pins = <
+				SC_P_USDHC1_CLK_CONN_USDHC1_CLK		0x06000040
+				SC_P_USDHC1_CMD_CONN_USDHC1_CMD		0x00000020
+				SC_P_USDHC1_DATA0_CONN_USDHC1_DATA0	0x00000020
+				SC_P_USDHC1_DATA1_CONN_USDHC1_DATA1	0x00000020
+				SC_P_USDHC1_DATA2_CONN_USDHC1_DATA2	0x00000020
+				SC_P_USDHC1_DATA3_CONN_USDHC1_DATA3	0x00000020
+				SC_P_USDHC1_VSELECT_CONN_USDHC1_VSELECT	0x00000020
+			>;
+		};
+	};
+};
+
+&lpuart0 { /* console */
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_lpuart0>;
+	status = "okay";
+};
+
+&usbotg1 {
+	srp-disable;
+	hnp-disable;
+	adp-disable;
+	disable-over-current;
+	status = "disabled";
+};
+
+&usb2 {
+	status = "disabled";
+};
+
+&usdhc2 {
+	pinctrl-names = "default", "state_100mhz", "state_200mhz";
+	pinctrl-0 = <&pinctrl_usdhc2>, <&pinctrl_usdhc2_gpio>;
+	pinctrl-1 = <&pinctrl_usdhc2_100mhz>, <&pinctrl_usdhc2_gpio>;
+	pinctrl-2 = <&pinctrl_usdhc2_200mhz>, <&pinctrl_usdhc2_gpio>;
+	bus-width = <4>;
+	cd-gpios = <&gpio5 22 GPIO_ACTIVE_LOW>;
+	wp-gpios = <&gpio5 21 GPIO_ACTIVE_HIGH>;
+	vmmc-supply = <&reg_mba8x_v3v3>;
+	status = "okay";
+};
diff --git a/arch/arm/dts/fsl-imx8qm-tqma8qm.dtsi b/arch/arm/dts/fsl-imx8qm-tqma8qm.dtsi
new file mode 100644
index 0000000000..36d241a208
--- /dev/null
+++ b/arch/arm/dts/fsl-imx8qm-tqma8qm.dtsi
@@ -0,0 +1,113 @@
+/*
+ * Copyright 2019 TQ Systems GmbH
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ */
+
+/ {
+	model = "TQ Systems GmbH TQMa8QM";
+	compatible = ",tq,tqma8qm", "fsl,imx8qm";
+};
+
+
+&i2c1 {
+	#address-cells = <1>;
+	#size-cells = <0>;
+	clock-frequency = <100000>;
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_lpi2c1>;
+	status = "okay";
+
+};
+
+&iomuxc {
+	tqma8x {
+		pinctrl_usdhc1: usdhc1grp {
+			fsl,pins = <
+				SC_P_EMMC0_CLK_CONN_EMMC0_CLK		0x06000041
+				SC_P_EMMC0_CMD_CONN_EMMC0_CMD		0x00000021
+				SC_P_EMMC0_DATA0_CONN_EMMC0_DATA0	0x00000021
+				SC_P_EMMC0_DATA1_CONN_EMMC0_DATA1	0x00000021
+				SC_P_EMMC0_DATA2_CONN_EMMC0_DATA2	0x00000021
+				SC_P_EMMC0_DATA3_CONN_EMMC0_DATA3	0x00000021
+				SC_P_EMMC0_DATA4_CONN_EMMC0_DATA4	0x00000021
+				SC_P_EMMC0_DATA5_CONN_EMMC0_DATA5	0x00000021
+				SC_P_EMMC0_DATA6_CONN_EMMC0_DATA6	0x00000021
+				SC_P_EMMC0_DATA7_CONN_EMMC0_DATA7	0x00000021
+				SC_P_EMMC0_STROBE_CONN_EMMC0_STROBE	0x06000041
+				SC_P_EMMC0_RESET_B_CONN_EMMC0_RESET_B	0x00000021
+			>;
+		};
+
+		pinctrl_usdhc1_100mhz: usdhc1grp100mhz {
+			fsl,pins = <
+				SC_P_EMMC0_CLK_CONN_EMMC0_CLK		0x06000040
+				SC_P_EMMC0_CMD_CONN_EMMC0_CMD		0x00000020
+				SC_P_EMMC0_DATA0_CONN_EMMC0_DATA0	0x00000020
+				SC_P_EMMC0_DATA1_CONN_EMMC0_DATA1	0x00000020
+				SC_P_EMMC0_DATA2_CONN_EMMC0_DATA2	0x00000020
+				SC_P_EMMC0_DATA3_CONN_EMMC0_DATA3	0x00000020
+				SC_P_EMMC0_DATA4_CONN_EMMC0_DATA4	0x00000020
+				SC_P_EMMC0_DATA5_CONN_EMMC0_DATA5	0x00000020
+				SC_P_EMMC0_DATA6_CONN_EMMC0_DATA6	0x00000020
+				SC_P_EMMC0_DATA7_CONN_EMMC0_DATA7	0x00000020
+				SC_P_EMMC0_STROBE_CONN_EMMC0_STROBE	0x06000040
+				SC_P_EMMC0_RESET_B_CONN_EMMC0_RESET_B	0x00000020
+			>;
+		};
+
+		pinctrl_usdhc1_200mhz: usdhc1grp200mhz {
+			fsl,pins = <
+				SC_P_EMMC0_CLK_CONN_EMMC0_CLK		0x06000040
+				SC_P_EMMC0_CMD_CONN_EMMC0_CMD		0x00000020
+				SC_P_EMMC0_DATA0_CONN_EMMC0_DATA0	0x00000020
+				SC_P_EMMC0_DATA1_CONN_EMMC0_DATA1	0x00000020
+				SC_P_EMMC0_DATA2_CONN_EMMC0_DATA2	0x00000020
+				SC_P_EMMC0_DATA3_CONN_EMMC0_DATA3	0x00000020
+				SC_P_EMMC0_DATA4_CONN_EMMC0_DATA4	0x00000020
+				SC_P_EMMC0_DATA5_CONN_EMMC0_DATA5	0x00000020
+				SC_P_EMMC0_DATA6_CONN_EMMC0_DATA6	0x00000020
+				SC_P_EMMC0_DATA7_CONN_EMMC0_DATA7	0x00000020
+				SC_P_EMMC0_STROBE_CONN_EMMC0_STROBE	0x06000040
+				SC_P_EMMC0_RESET_B_CONN_EMMC0_RESET_B	0x00000020
+			>;
+		};
+
+		pinctrl_lpi2c1: lpi2c1grp {
+			fsl,pins = <
+				SC_P_GPT0_CAPTURE_DMA_I2C1_SDA		0x06000020
+				SC_P_GPT0_CLK_DMA_I2C1_SCL		0x06000020
+			>;
+		};
+	};
+};
+
+&gpio2 {
+	status = "okay";
+};
+
+&gpio4 {
+	status = "okay";
+};
+
+&gpio5 {
+	status = "okay";
+};
+
+&usdhc1 {
+	pinctrl-names = "default", "state_100mhz", "state_200mhz";
+	pinctrl-0 = <&pinctrl_usdhc1>;
+	pinctrl-1 = <&pinctrl_usdhc1_100mhz>;
+	pinctrl-2 = <&pinctrl_usdhc1_200mhz>;
+	bus-width = <8>;
+	non-removable;
+	status = "okay";
+};
diff --git a/board/tqc/tqma8x/tqma8x-mba8x.c b/board/tqc/tqma8x/tqma8x-mba8x.c
index d96a779d82..a816a45924 100644
--- a/board/tqc/tqma8x/tqma8x-mba8x.c
+++ b/board/tqc/tqma8x/tqma8x-mba8x.c
@@ -29,7 +29,7 @@
 #include "../common/tqc_board_gpio.h"
 #include "../common/tqc_eeprom.h"
 
-#define MBA8XX_BOARD_NAME "MBa8Xx"
+#define MBA8X_BOARD_NAME "MBa8x"
 
 DECLARE_GLOBAL_DATA_PTR;
 
@@ -51,7 +51,7 @@ static const iomux_cfg_t board_pcie_pins[] = {
 
 static void setup_iomux_pcie(void)
 {
-	imx8_iomux_setup_multiple_pads(board_pcie_pins, ARRAY_SIZE(board_pcie_pins));
+// 	imx8_iomux_setup_multiple_pads(board_pcie_pins, ARRAY_SIZE(board_pcie_pins));
 }
 
 static iomux_cfg_t uart1_pads[] = {
@@ -98,12 +98,12 @@ int tqc_bb_board_early_init_f(void)
 
 int tqc_bb_checkboard(void)
 {
-	puts("Board: " TQMA8_BOARD_NAME " on " MBA8XX_BOARD_NAME " (" TQMA8_BOARD_REV ")\n");
+	puts("Board: " TQMA8_BOARD_NAME " on " MBA8X_BOARD_NAME " (" TQMA8_BOARD_REV ")\n");
 
 	return 0;
 }
 
-static const struct tqc_gpio_init_data mba8xx_gid[] = {
+static const struct tqc_gpio_init_data mba8x_gid[] = {
 	{
 		.name = "GPIO3_5",
 		.label = "REV_0",
@@ -137,7 +137,7 @@ static const struct tqc_gpio_init_data mba8xx_gid[] = {
 
 int tqc_bb_board_init(void)
 {
-	return tqc_board_gpio_init(mba8xx_gid, ARRAY_SIZE(mba8xx_gid));
+// 	return tqc_board_gpio_init(mba8x_gid, ARRAY_SIZE(mba8x_gid));
 
 }
 
@@ -165,8 +165,8 @@ int mmc_map_to_kernel_blk(int dev_no)
 int tqc_bb_board_late_init(void)
 {
 #ifdef CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG
-	env_set("board_name", "MBA8XX_BOARD_NAME");
-	env_set("board_rev", "iMX8QXP");
+	env_set("board_name", "MBA8X_BOARD_NAME");
+	env_set("board_rev", "iMX8QM");
 #endif
 
 #ifdef CONFIG_ENV_IS_IN_MMC
@@ -180,10 +180,6 @@ void board_quiesce_devices()
 {
 	const char *power_on_devices[] = {
 		"dma_lpuart1",
-
-		/* HIFI DSP boot */
-		"audio_sai0",
-		"audio_ocram",
 	};
 
 	power_off_pd_devices(power_on_devices, ARRAY_SIZE(power_on_devices));
diff --git a/board/tqc/tqma8x/tqma8x.c b/board/tqc/tqma8x/tqma8x.c
index c839fa9fa6..d89b5cbf66 100644
--- a/board/tqc/tqma8x/tqma8x.c
+++ b/board/tqc/tqma8x/tqma8x.c
@@ -1,5 +1,5 @@
 /*
- * Copyright 2018-2019 TQ Systems GmbH
+ * Copyright 2019 TQ Systems GmbH
  *
  * SPDX-License-Identifier:	GPL-2.0+
  */
@@ -109,9 +109,10 @@ int board_late_init(void)
 
 	tqc_bb_board_late_init();
 
-	env_set("sec_boot", "no");
 #ifdef CONFIG_AHAB_BOOT
 	env_set("sec_boot", "yes");
+#else
+	env_set("sec_boot", "no");
 #endif
 
 	return 0;
diff --git a/configs/tqma8qm_mba8x_mmc_defconfig b/configs/tqma8qm_mba8x_mmc_defconfig
index e3e3d336d0..044d164646 100644
--- a/configs/tqma8qm_mba8x_mmc_defconfig
+++ b/configs/tqma8qm_mba8x_mmc_defconfig
@@ -1,98 +1,94 @@
 CONFIG_ARM=y
 CONFIG_ARCH_IMX8=y
-CONFIG_DEFAULT_DEVICE_TREE="fsl-imx8qm-mek"
-CONFIG_TARGET_TQMA8X=yy
 CONFIG_SYS_TEXT_BASE=0x80020000
-CONFIG_CMD_IMPORTENV=n
 CONFIG_SYS_MALLOC_F_LEN=0x2000
+CONFIG_SMC_FUSE=y
+CONFIG_TARGET_TQMA8X=y
+CONFIG_IMX_BOOTAUX=y
+CONFIG_DISTRO_DEFAULTS=y
+CONFIG_BOOTDELAY=3
+CONFIG_BOOTCOMMAND="run mmcboot"
+CONFIG_VERSION_VARIABLE=y
+CONFIG_ARCH_MISC_INIT=y
+CONFIG_BOARD_EARLY_INIT_F=y
+CONFIG_CMD_LICENSE=y
+CONFIG_CMD_GREPENV=y
+CONFIG_CMD_MEMINFO=y
+# CONFIG_CMD_FLASH is not set
+CONFIG_CMD_IMPORTENV=n
 CONFIG_DM=y
-CONFIG_CMD_CACHE=y
 
-CONFIG_DM_SERIAL=y
-CONFIG_FSL_LPUART=y
 CONFIG_OF_CONTROL=y
-CONFIG_DM_I2C=y
-# CONFIG_DM_I2C_COMPAT is not set
-CONFIG_SYS_I2C_IMX_LPI2C=y
+CONFIG_CMD_GPIO=y
+CONFIG_CMD_GPT=y
 CONFIG_CMD_I2C=y
-
-CONFIG_FASTBOOT=y
-CONFIG_USB_FUNCTION_FASTBOOT=y
-CONFIG_CMD_FASTBOOT=y
-CONFIG_ANDROID_BOOT_IMAGE=y
-CONFIG_FSL_FASTBOOT=y
-CONFIG_FASTBOOT_BUF_ADDR=0x82800000
-CONFIG_FASTBOOT_BUF_SIZE=0x40000000
-CONFIG_FASTBOOT_FLASH=y
-CONFIG_FASTBOOT_FLASH_MMC_DEV=0
-CONFIG_FASTBOOT_USB_DEV=1
+# CONFIG_CMD_LOADB is not set
+# CONFIG_CMD_LOADS is not set
+CONFIG_CMD_MMC=y
+CONFIG_CMD_SF=y
+CONFIG_CMD_USB=y
+CONFIG_CMD_CACHE=y
+CONFIG_CMD_EXT4_WRITE=y
+# CONFIG_ISO_PARTITION is not set
+CONFIG_ENV_IS_IN_MMC=y
 
 CONFIG_USB_XHCI_HCD=y
 CONFIG_USB_XHCI_IMX8=y
 
-CONFIG_DM_USB=y
-CONFIG_USB_EHCI_HCD=y
-
-CONFIG_CMD_USB=y
-CONFIG_USB=y
-CONFIG_USB_STORAGE=y
 CONFIG_USB_TCPC=y
 
-CONFIG_CMD_USB_MASS_STORAGE=y
-CONFIG_USB_GADGET=y
-# CONFIG_CI_UDC=y
-CONFIG_USB_GADGET_DOWNLOAD=y
-CONFIG_USB_GADGET_MANUFACTURER="FSL"
-CONFIG_USB_GADGET_VENDOR_NUM=0x0525
-CONFIG_USB_GADGET_PRODUCT_NUM=0xa4a5
 
 CONFIG_USB_CDNS3=y
 CONFIG_USB_CDNS3_GADGET=y
-CONFIG_USB_GADGET_DUALSPEED=y
 
-CONFIG_CMD_GPIO=y
 CONFIG_DM_GPIO=y
+CONFIG_MXC_GPIO=y
 CONFIG_DM_PCA953X=y
-CONFIG_BOOTDELAY=3
-CONFIG_IMX_BOOTAUX=y
+CONFIG_DM_I2C=y
+CONFIG_DM_I2C_COMPAT=y
+CONFIG_SYS_I2C_IMX_LPI2C=y
+CONFIG_MISC=y
+CONFIG_I2C_EEPROM=y
 CONFIG_FS_FAT=y
 CONFIG_CMD_FAT=y
-CONFIG_CMD_MMC=y
 CONFIG_DM_MMC=y
 CONFIG_MMC_IO_VOLTAGE=y
 CONFIG_MMC_UHS_SUPPORT=y
+CONFIG_MMC_HS400_ES_SUPPORT=y
 CONFIG_MMC_HS400_SUPPORT=y
 CONFIG_EFI_PARTITION=y
 CONFIG_FSL_FSPI=y
-CONFIG_DM_SPI=y
 CONFIG_DM_SPI_FLASH=y
 CONFIG_SPI_FLASH=y
 CONFIG_SPI_FLASH_4BYTES_ADDR=y
 CONFIG_SPI_FLASH_STMICRO=y
-CONFIG_CMD_SF=y
 
 CONFIG_CMD_PING=y
 CONFIG_CMD_DHCP=y
 CONFIG_CMD_MII=y
+# CONFIG_SPI_FLASH_USE_4K_SECTORS is not set
+CONFIG_PHYLIB=y
+CONFIG_PHY_TI=y
 CONFIG_DM_ETH=y
-# CONFIG_EFI_LOADER is not set
-
-CONFIG_DM_REGULATOR=y
-CONFIG_DM_REGULATOR_FIXED=y
-CONFIG_DM_REGULATOR_GPIO=y
-
-CONFIG_VIDEO=y
-CONFIG_VIDEO_IMX_HDP_LOAD=y
-
+CONFIG_PHY_GIGE=y
 CONFIG_PINCTRL=y
 CONFIG_PINCTRL_IMX8=y
-
 CONFIG_POWER_DOMAIN=y
 CONFIG_IMX8_POWER_DOMAIN=y
-
+CONFIG_DM_REGULATOR=y
+CONFIG_DM_REGULATOR_FIXED=y
+CONFIG_DM_REGULATOR_GPIO=y
+CONFIG_DM_RTC=y
+CONFIG_RTC_DS1307=y
+CONFIG_DM_SERIAL=y
+CONFIG_FSL_LPUART=y
+CONFIG_DM_SPI=y
 CONFIG_DM_THERMAL=y
 CONFIG_IMX_SC_THERMAL=y
-
-CONFIG_ENV_IS_IN_MMC=y
-
-CONFIG_SMC_FUSE=y
+CONFIG_USB=y
+CONFIG_DM_USB=y
+CONFIG_USB_EHCI_HCD=y
+CONFIG_MXC_USB_OTG_HACTIVE=y
+CONFIG_USB_STORAGE=y
+CONFIG_FAT_WRITE=y
+# CONFIG_EFI_LOADER is not set
diff --git a/include/configs/tqma8x.h b/include/configs/tqma8x.h
index 9de1684b42..eb6a1ee56e 100644
--- a/include/configs/tqma8x.h
+++ b/include/configs/tqma8x.h
@@ -396,7 +396,7 @@
 #endif
 
 #define CONFIG_EXTRA_ENV_SETTINGS		\
-	TQMA8XX_MODULE_ENV_SETTINGS		\
+	TQMA8X_MODULE_ENV_SETTINGS		\
 	BB_ENV_SETTINGS
 
 #ifndef CONFIG_SPL_BUILD
