From 78136b63135795aad97ef5f9a1ba67b352104cb7 Mon Sep 17 00:00:00 2001
From: Michael Krummsdorf <michael.krummsdorf@tq-group.com>
Date: Wed, 17 Jan 2018 15:09:13 +0100
Subject: [PATCH 045/188] net: phy: dp83867: change dt properties to optional

Otherwise PHY would not initialize correctly when in SGMII mode and no delays defined.
LEDCFG and FIFO-DEPTH optional as well.

Signed-off-by: Michael Krummsdorf <michael.krummsdorf@tq-group.com>
---
 Documentation/devicetree/bindings/net/ti,dp83867.txt |  8 ++++----
 drivers/net/phy/dp83867.c                            | 10 +++++++---
 2 files changed, 11 insertions(+), 7 deletions(-)

diff --git a/Documentation/devicetree/bindings/net/ti,dp83867.txt b/Documentation/devicetree/bindings/net/ti,dp83867.txt
index 397a539f0bc2..986529af43b9 100644
--- a/Documentation/devicetree/bindings/net/ti,dp83867.txt
+++ b/Documentation/devicetree/bindings/net/ti,dp83867.txt
@@ -8,10 +8,6 @@ Required properties:
 	- ti,tx-internal-delay - RGMII Transmit Clock Delay - see dt-bindings/net/ti-dp83867.h
 		for applicable values. Required only if interface type is
 		PHY_INTERFACE_MODE_RGMII_ID or PHY_INTERFACE_MODE_RGMII_TXID
-	- ti,fifo-depth - Transmitt FIFO depth- see dt-bindings/net/ti-dp83867.h
-		for applicable values
-	- ti,led-cfg1 - Value of LED configuration register 1
-	- ti,led-cfg2 - Value of LED configuration register 2
 
 Optional property:
 	- ti,min-output-impedance - MAC Interface Impedance control to set
@@ -27,6 +23,10 @@ Optional property:
 				    software needs to take when this pin is
 				    strapped in these modes. See data manual
 				    for details.
+	- ti,fifo-depth 	  - Transmit FIFO depth - see dt-bindings/net/ti-dp83867.h
+				                          for applicable values
+	- ti,led-cfg1		  - Value of LED configuration register 1
+	- ti,led-cfg2		  - Value of LED configuration register 2
 
 Note: ti,min-output-impedance and ti,max-output-impedance are mutually
       exclusive. When both properties are present ti,max-output-impedance
diff --git a/drivers/net/phy/dp83867.c b/drivers/net/phy/dp83867.c
index 057bdf1df219..6813361ca9cb 100644
--- a/drivers/net/phy/dp83867.c
+++ b/drivers/net/phy/dp83867.c
@@ -195,15 +195,19 @@ static int dp83867_of_init(struct phy_device *phydev)
 	ret = of_property_read_u32(of_node, "ti,led-cfg1",
 				&dp83867->led_cfg1);
 	if (ret)
-		return ret;
+		dev_dbg(dev, "could not find ti,led-cfg1\n");
 
 	ret = of_property_read_u32(of_node, "ti,led-cfg2",
 				&dp83867->led_cfg2);
 	if (ret)
-		return ret;
+		dev_dbg(dev, "could not find ti,led-cfg2\n");
 
-	return of_property_read_u32(of_node, "ti,fifo-depth",
+	ret = of_property_read_u32(of_node, "ti,fifo-depth",
 				   &dp83867->fifo_depth);
+	if (ret)
+		dev_dbg(dev, "could not find ti,fifo-depth\n");
+
+	return 0;
 }
 #else
 static int dp83867_of_init(struct phy_device *phydev)
