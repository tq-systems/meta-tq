From 943912e6f80274cfff0855a979eb00dad8891a91 Mon Sep 17 00:00:00 2001
From: Markus Niebel <Markus.Niebel@tq-group.com>
Date: Mon, 10 Sep 2018 11:12:10 +0200
Subject: [PATCH 017/188] arm: dt: imx6qdl-mba6: add pcie

Signed-off-by: Markus Niebel <Markus.Niebel@tq-group.com>
---
 arch/arm/boot/dts/imx6qdl-mba6.dtsi | 31 +++++++++++++++++++++++++++++
 1 file changed, 31 insertions(+)

diff --git a/arch/arm/boot/dts/imx6qdl-mba6.dtsi b/arch/arm/boot/dts/imx6qdl-mba6.dtsi
index 9db0cf85c1e9..5aeb55d0fe45 100644
--- a/arch/arm/boot/dts/imx6qdl-mba6.dtsi
+++ b/arch/arm/boot/dts/imx6qdl-mba6.dtsi
@@ -93,6 +93,19 @@
 			enable-active-high;
 			vin_supply = <&reg_3p3v>;
 		};
+
+		reg_pcie: regulator@3 {
+			compatible = "regulator-fixed";
+			reg = <3>;
+			regulator-name = "supply-pcie";
+			regulator-min-microvolt = <3300000>;
+			regulator-max-microvolt = <3300000>;
+			/* PCIE.PWR_EN */
+			gpio = <&gpio2 0 GPIO_ACTIVE_HIGH>;
+			enable-active-high;
+			regulator-always-on;
+			vin_supply = <&reg_mba6_3p3v>;
+		};
 	};
 };
 
@@ -240,6 +253,17 @@
 			>;
 		};
 
+		pinctrl_pcie: pciegrp {
+			fsl,pins = <
+				/* HYS = 1, DSE = 110, 100k up, SPEED = HIGH (11)*/
+				MX6QDL_PAD_SD4_DAT3__GPIO2_IO11 0x001b0f0 /* #PCIE.WAKE */
+				MX6QDL_PAD_NANDF_CLE__GPIO6_IO07 0x001b0f0 /* #PCIE.RST */
+				MX6QDL_PAD_NANDF_CS0__GPIO6_IO11 0x001b0f0 /* #PCIE.DIS */
+				/* HYS = 1, DSE = 110, PUE+PKE, SPEED = HIGH (11)*/
+				MX6QDL_PAD_NANDF_D0__GPIO2_IO00 0x00130f0 /* PCIE.PWR_EN */
+			>;
+		};
+
 		pinctrl_pwm1: pwm1grp {
 			fsl,pins = <
 				/* 100 k PD, DSE 120 OHM, SPPEED LO */
@@ -334,6 +358,13 @@
 	};
 };
 
+&pcie {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_pcie>;
+	reset-gpio = <&gpio6 7 GPIO_ACTIVE_LOW>;
+	status = "okay";
+};
+
 &pwm1 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_pwm1>;
