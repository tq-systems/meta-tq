From 21827ed2f45ae53d194383c746e5490b52803be1 Mon Sep 17 00:00:00 2001
From: Max Merchel <Max.Merchel@tq-group.com>
Date: Thu, 24 Jan 2019 15:00:57 +0100
Subject: [PATCH 109/188] arm: dt: imx7-mba7: add usbotg

Signed-off-by: Max Merchel <Max.Merchel@tq-group.com>
---
 arch/arm/boot/dts/imx7-mba7.dtsi  | 38 +++++++++++++++++++++++++++++++
 arch/arm/boot/dts/imx7d-mba7.dtsi | 22 ++++++++++++++++++
 2 files changed, 60 insertions(+)

diff --git a/arch/arm/boot/dts/imx7-mba7.dtsi b/arch/arm/boot/dts/imx7-mba7.dtsi
index ac1a99844684..7cde15c668d9 100644
--- a/arch/arm/boot/dts/imx7-mba7.dtsi
+++ b/arch/arm/boot/dts/imx7-mba7.dtsi
@@ -137,6 +137,26 @@
 			regulator-always-on;
 		};
 
+		reg_usb_otg1_vbus: regulator@3 {
+			compatible = "regulator-fixed";
+			reg = <3>;
+			regulator-name = "VBUS_USBOTG1";
+			regulator-min-microvolt = <5000000>;
+			regulator-max-microvolt = <5000000>;
+			gpio = <&gpio1 5 GPIO_ACTIVE_HIGH>;
+			enable-active-high;
+		};
+
+		reg_usb_otg2_vbus: regulator@4 {
+			compatible = "regulator-fixed";
+			reg = <4>;
+			regulator-name = "VBUS_USBOTG2";
+			regulator-min-microvolt = <5000000>;
+			regulator-max-microvolt = <5000000>;
+			gpio = <&gpio1 7 GPIO_ACTIVE_HIGH>;
+			enable-active-high;
+		};
+
 		reg_vref_1v8: regulator@9 {
 			compatible = "regulator-fixed";
 			reg = <9>;
@@ -421,6 +441,13 @@
 
 &iomuxc_lpsr {
 	imx7-mba7 {
+		pinctrl_usbotg1: usbotg1grp {
+			fsl,pins = <
+				MX7D_PAD_LPSR_GPIO1_IO04__USB_OTG1_OC	0x5c
+				MX7D_PAD_LPSR_GPIO1_IO05__GPIO1_IO5	0x59
+			>;
+		};
+
 		pinctrl_wdog1: wdog1grp {
 			fsl,pins = <
 				MX7D_PAD_LPSR_GPIO1_IO00__WDOG1_WDOG_B	0x30
@@ -441,6 +468,17 @@
 	status = "okay";
 };
 
+&usbotg1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_usbotg1>;
+	vbus-supply = <&reg_usb_otg1_vbus>;
+	srp-disable;
+	hnp-disable;
+	adp-disable;
+	dr_mode = "otg";
+	status = "okay";
+};
+
 &usdhc1 {
 	pinctrl-names = "default", "state_100mhz", "state_200mhz";
 	pinctrl-0 = <&pinctrl_usdhc1>, <&pinctrl_usdhc1_gpio>;
diff --git a/arch/arm/boot/dts/imx7d-mba7.dtsi b/arch/arm/boot/dts/imx7d-mba7.dtsi
index caf050175fb8..edf4582bbe6d 100644
--- a/arch/arm/boot/dts/imx7d-mba7.dtsi
+++ b/arch/arm/boot/dts/imx7d-mba7.dtsi
@@ -75,6 +75,17 @@
 	};
 };
 
+&iomuxc_lpsr {
+	imx7d-mba7 {
+		pinctrl_usbotg2: usbotg2grp {
+			fsl,pins = <
+				MX7D_PAD_LPSR_GPIO1_IO06__USB_OTG2_OC	0x5c
+				MX7D_PAD_LPSR_GPIO1_IO07__GPIO1_IO7	0x59
+			>;
+		};
+	};
+};
+
 &pcie {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_pcie>;
@@ -91,3 +102,14 @@
 	ext_osc = <0>;
 	status = "okay";
 };
+
+&usbotg2 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_usbotg2>;
+	vbus-supply = <&reg_usb_otg2_vbus>;
+	srp-disable;
+	hnp-disable;
+	adp-disable;
+	dr_mode = "host";
+	status = "okay";
+};
