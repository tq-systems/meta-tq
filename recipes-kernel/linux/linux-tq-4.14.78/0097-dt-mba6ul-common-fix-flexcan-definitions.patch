From b8d8060233137b4ea5aa58567b543d10884dfd1e Mon Sep 17 00:00:00 2001
From: Michael Krummsdorf <michael.krummsdorf@tq-group.com>
Date: Wed, 6 Feb 2019 16:27:52 +0100
Subject: [PATCH 097/188] dt: mba6ul-common: fix flexcan definitions

Signed-off-by: Michael Krummsdorf <michael.krummsdorf@tq-group.com>
---
 arch/arm/boot/dts/imx6ul-mba6ulx-lga.dts  | 14 ++++++++++++++
 arch/arm/boot/dts/imx6ul-mba6ulx.dts      | 14 ++++++++++++++
 arch/arm/boot/dts/imx6ull-mba6ulx-lga.dts | 14 ++++++++++++++
 arch/arm/boot/dts/imx6ull-mba6ulx.dts     | 14 ++++++++++++++
 arch/arm/boot/dts/mba6ul-common.dtsi      | 19 ++++++-------------
 5 files changed, 62 insertions(+), 13 deletions(-)

diff --git a/arch/arm/boot/dts/imx6ul-mba6ulx-lga.dts b/arch/arm/boot/dts/imx6ul-mba6ulx-lga.dts
index 983dea014105..788d494fcd69 100644
--- a/arch/arm/boot/dts/imx6ul-mba6ulx-lga.dts
+++ b/arch/arm/boot/dts/imx6ul-mba6ulx-lga.dts
@@ -19,3 +19,17 @@
 	model = "TQ Systems i.MX6 UltraLite Baseboard with TQMa6ULxL";
 	compatible = "tqc,imx6ul-mba6ulx-lga", "tqc,imx6ul-mba6ul", "fsl,imx6ul";
 };
+
+&can1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_flexcan1>;
+	xceiver-supply = <&reg_can_3v3>;
+	status = "okay";
+};
+
+&can2 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_flexcan2>;
+	xceiver-supply = <&reg_can_3v3>;
+	status = "okay";
+};
diff --git a/arch/arm/boot/dts/imx6ul-mba6ulx.dts b/arch/arm/boot/dts/imx6ul-mba6ulx.dts
index 0c543cb9ac0d..2fab1cfb4f8c 100644
--- a/arch/arm/boot/dts/imx6ul-mba6ulx.dts
+++ b/arch/arm/boot/dts/imx6ul-mba6ulx.dts
@@ -19,3 +19,17 @@
 	model = "TQ Systems i.MX6 UltraLite Baseboard with TQMa6ULx";
 	compatible = "tqc,imx6ul-mba6ulx", "tqc,imx6ul-mba6ul", "fsl,imx6ul";
 };
+
+&can1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_flexcan1>;
+	xceiver-supply = <&reg_can_3v3>;
+	status = "okay";
+};
+
+&can2 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_flexcan2>;
+	xceiver-supply = <&reg_can_3v3>;
+	status = "okay";
+};
diff --git a/arch/arm/boot/dts/imx6ull-mba6ulx-lga.dts b/arch/arm/boot/dts/imx6ull-mba6ulx-lga.dts
index d87d743cdb92..b69005ce5179 100644
--- a/arch/arm/boot/dts/imx6ull-mba6ulx-lga.dts
+++ b/arch/arm/boot/dts/imx6ull-mba6ulx-lga.dts
@@ -19,3 +19,17 @@
 	model = "TQ Systems i.MX6 UltraLite Baseboard with TQMa6ULLxL";
 	compatible = "tqc,imx6ull-mba6ulx-lga", "tqc,imx6ull-mba6ul", "fsl,imx6ull";
 };
+
+&flexcan1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_flexcan1>;
+	xceiver-supply = <&reg_can_3v3>;
+	status = "okay";
+};
+
+&flexcan2 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_flexcan2>;
+	xceiver-supply = <&reg_can_3v3>;
+	status = "okay";
+};
diff --git a/arch/arm/boot/dts/imx6ull-mba6ulx.dts b/arch/arm/boot/dts/imx6ull-mba6ulx.dts
index dfe7b7cf0989..0b6574ab1bb3 100644
--- a/arch/arm/boot/dts/imx6ull-mba6ulx.dts
+++ b/arch/arm/boot/dts/imx6ull-mba6ulx.dts
@@ -19,3 +19,17 @@
 	model = "TQ Systems i.MX6 UltraLite Baseboard with TQMa6ULLx";
 	compatible = "tqc,imx6ull-mba6ulx", "tqc,imx6ull-mba6ul", "fsl,imx6ull";
 };
+
+&flexcan1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_flexcan1>;
+	xceiver-supply = <&reg_can_3v3>;
+	status = "okay";
+};
+
+&flexcan2 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_flexcan2>;
+	xceiver-supply = <&reg_can_3v3>;
+	status = "okay";
+};
diff --git a/arch/arm/boot/dts/mba6ul-common.dtsi b/arch/arm/boot/dts/mba6ul-common.dtsi
index 3d4171a588f4..0c21ad0e381a 100644
--- a/arch/arm/boot/dts/mba6ul-common.dtsi
+++ b/arch/arm/boot/dts/mba6ul-common.dtsi
@@ -305,19 +305,12 @@
 	};
 };
 
-&flexcan1 {
-	pinctrl-names = "default";
-	pinctrl-0 = <&pinctrl_flexcan1>;
-	xceiver-supply = <&reg_can_3v3>;
-	status = "okay";
-};
-
-&flexcan2 {
-	pinctrl-names = "default";
-	pinctrl-0 = <&pinctrl_flexcan2>;
-	xceiver-supply = <&reg_can_3v3>;
-	status = "okay";
-};
+/* Linux rel_imx-4.14.78_1.0.0_ga by NXP defines the
+ * flexcan controller instances on CPUs i.MX6UL and i.MX6ULL
+ * at their respective addresses 02090000 and 02094000
+ * on two different paths. This forbids a common reference.
+ * Moved CAN nodes to imx6ull-mba6ulx.dts / imx6ul-mba6ulx.dts.
+ */
 
 &i2c4 {
 	codec: tlv320aic32x4@18 {
