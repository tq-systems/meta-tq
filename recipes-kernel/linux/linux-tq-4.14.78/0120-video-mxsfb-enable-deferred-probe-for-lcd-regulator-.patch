From edee369b3aa2cc3a21ea8dde8af8100c0e8a9f39 Mon Sep 17 00:00:00 2001
From: Markus Niebel <Markus.Niebel@tq-group.com>
Date: Mon, 23 Jan 2017 17:20:19 +0100
Subject: [PATCH 120/188] video: mxsfb: enable deferred probe for lcd regulator
 device

workaround for gpio on port expander

Signed-off-by: Markus Niebel <Markus.Niebel@tq-group.com>
---
 drivers/video/fbdev/mxsfb.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/drivers/video/fbdev/mxsfb.c b/drivers/video/fbdev/mxsfb.c
index 5659ec2d18c4..c383b50a030b 100644
--- a/drivers/video/fbdev/mxsfb.c
+++ b/drivers/video/fbdev/mxsfb.c
@@ -2274,8 +2274,13 @@ static int mxsfb_probe(struct platform_device *pdev)
 	}
 
 	host->reg_lcd = devm_regulator_get(&pdev->dev, "lcd");
-	if (IS_ERR(host->reg_lcd))
+	if (IS_ERR(host->reg_lcd)) {
+		if (-EPROBE_DEFER == PTR_ERR(host->reg_lcd)) {
+			ret = -EPROBE_DEFER;
+			goto fb_release;
+		}
 		host->reg_lcd = NULL;
+	}
 
 	fb_info->pseudo_palette = devm_kzalloc(&pdev->dev, sizeof(u32) * 16,
 					       GFP_KERNEL);
