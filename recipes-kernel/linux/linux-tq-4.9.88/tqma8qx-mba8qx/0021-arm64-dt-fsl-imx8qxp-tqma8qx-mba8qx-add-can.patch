From c214604db8b420442698fb5f0ca2beebff4f202f Mon Sep 17 00:00:00 2001
From: Markus Niebel <Markus.Niebel@tq-group.com>
Date: Thu, 8 Nov 2018 18:34:33 +0100
Subject: [PATCH] arm64: dt: fsl-imx8qxp-tqma8qx-mba8qx: add can

Signed-off-by: Markus Niebel <Markus.Niebel@tq-group.com>
---
 .../freescale/fsl-imx8qxp-tqma8qx-mba8qx.dtsi | 42 ++++++++++++++++---
 1 file changed, 36 insertions(+), 6 deletions(-)

diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8qxp-tqma8qx-mba8qx.dtsi b/arch/arm64/boot/dts/freescale/fsl-imx8qxp-tqma8qx-mba8qx.dtsi
index 2a12a288332a..3fdb24c0f4e8 100644
--- a/arch/arm64/boot/dts/freescale/fsl-imx8qxp-tqma8qx-mba8qx.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8qxp-tqma8qx-mba8qx.dtsi
@@ -81,9 +81,33 @@
 			enable-active-high;
 			status = "okay";
 		};
+
+		reg_mba8qx_3v3: mba8qx_3v3 {
+			compatible = "regulator-fixed";
+			regulator-name = "MBA8QX_3V3";
+			regulator-min-microvolt = <3300000>;
+			regulator-max-microvolt = <3300000>;
+			regulator-always-on;
+			status = "okay";
+		};
 	};
 };
 
+/* CPU device tree mixes up counting from 0 and counting from 1 */
+&flexcan1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_can0>;
+	xceiver-supply = <&reg_mba8qx_3v3>;
+	status = "okay";
+};
+
+&flexcan2 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_can1>;
+	xceiver-supply = <&reg_mba8qx_3v3>;
+	status = "okay";
+};
+
 &i2c1 {
 	/*
 	 * NXP SE97BTP with temperature sensor + eeprom
@@ -120,18 +144,24 @@
 &iomuxc {
 	pinctrl-names = "default";
 	tqma8qx-mba8qx {
+		pinctrl_lpuart1: lpuart1grp {
+			fsl,pins = <
+				SC_P_UART1_RX_ADMA_UART1_RX	0x06000020
+				SC_P_UART1_TX_ADMA_UART1_TX	0x06000020
+			>;
+		};
 
-		pinctrl_lpuart0: lpuart0grp {
+		pinctrl_can0: can0grp {
 			fsl,pins = <
-				SC_P_UART0_RX_ADMA_UART0_RX	0x06000020
-				SC_P_UART0_TX_ADMA_UART0_TX	0x06000020
+				SC_P_UART0_RX_ADMA_FLEXCAN0_RX	0x06000020
+				SC_P_UART0_TX_ADMA_FLEXCAN0_TX	0x06000020
 			>;
 		};
 
-		pinctrl_lpuart1: lpuart1grp {
+		pinctrl_can1: can1grp {
 			fsl,pins = <
-				SC_P_UART1_RX_ADMA_UART1_RX	0x06000020
-				SC_P_UART1_TX_ADMA_UART1_TX	0x06000020
+				SC_P_UART2_RX_ADMA_FLEXCAN1_RX	0x06000020
+				SC_P_UART2_TX_ADMA_FLEXCAN1_TX	0x06000020
 			>;
 		};
 
